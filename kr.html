<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>KR — KillB Rewards</title>
  <!-- Tipografía: Montserrat -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#1A1A1A;
      --primary:#1A1A1A;   /* Negro / antracita */
      --highlight:#ffc701; /* Naranja KillB */
      --muted:#6B6B6B;     /* Gris texto secundario */
      --card-bg:#F5F5F5;   /* Fondo de paneles */
      --line:#DDDDDD;      /* Borde suave */
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:'Montserrat',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--primary);
      background:var(--bg);
    }
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    header.hero{
      display:grid;grid-template-columns:1fr 1fr;gap:24px;align-items:center;
      padding:28px;background:var(--primary);color:var(--bg);
      border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,.24);
    }
    h1{margin:.1em 0 .2em;font-weight:800;font-size:clamp(28px,3.6vw,44px);letter-spacing:.3px}
    .subtitle{color:#EAEAEA;font-size:clamp(14px,1.6vw,18px)}
    .badges{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .chip{
      background:var(--card-bg);border:1px solid var(--line);
      padding:6px 10px;border-radius:999px;font-size:12px;color:var(--primary);
    }
    .note{color:#fff;font-size:13px;margin-top:12px}
    a.site-link{color:var(--highlight);text-decoration:none;font-size:.9rem;margin-top:6px;display:inline-block}
    .viz{display:grid;gap:14px;justify-items:center}
    .meter{width:100%;height:12px;border-radius:999px;background:#ffece0;position:relative;overflow:hidden;border:1px solid var(--line)}
    .meter>i{position:absolute;inset:0;transform:scaleX(var(--p,0));transform-origin:left;background:var(--highlight);border-right:2px solid rgba(0,0,0,.12)}
    .legend{display:flex;gap:16px;flex-wrap:wrap;color:#fff;font-size:12px}
    .legend b{color:#fff}
    section.panel{
      margin-top:20px;background:var(--card-bg);border:1px solid var(--line);
      border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,.12);padding:18px;
    }
    .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fill,minmax(180px,1fr))}
    .field{display:flex;flex-direction:column;gap:6px}
    label{font-weight:600;font-size:13px;color:var(--primary)}
    input[type="number"]{
      border:1px solid var(--line);background:#fff;padding:10px 12px;border-radius:10px;font-size:14px;outline:none;color:var(--primary);
    }
    input[type="number"]:focus{border-color:var(--highlight);box-shadow:0 0 0 3px rgba(255,102,0,.2)}
    .kpis{display:grid;gap:12px;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));margin-top:8px}
    .kpi{border:1px dashed var(--line);border-radius:12px;padding:12px;background:#fffaf3}
    .kpi .lbl{font-size:12px;color:var(--muted)}
    .kpi .val{font-size:20px;font-weight:800;color:var(--primary)}
    table{width:100%;border-collapse:separate;border-spacing:0;margin-top:8px;font-variant-numeric:tabular-nums lining-nums;color:var(--primary)}
    thead th{
      text-align:right;background:var(--highlight);color:#1;border-bottom:2px solid var(--primary);
      padding:10px 12px;position:sticky;top:0
    }
    thead th:first-child,tbody td:first-child{text-align:center}
    thead th:nth-child(3),tbody td:nth-child(3){text-align:center}
    tbody td{text-align:right;border-bottom:1px solid var(--line);padding:10px 12px}
    tbody tr:last-child td{border-bottom:0}
    tbody tr:nth-child(odd){background:#fffaf3}
    .panel .note{color:var(--muted);font-size:13px;margin-top:12px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
    .btn{
      background:var(--highlight);color:#aaaaa;border:0;border-radius:10px;padding:8px 12px;font-weight:700;cursor:pointer
    }
    .btn.ghost{background:transparent;color:var(--primary);border:1px solid var(--line)}
    footer{color:var(--muted);text-align:center;margin:28px 0 8px;font-size:12px}
    @media (max-width:980px){ header.hero{grid-template-columns:1fr} }
    @media print{ .wrap{padding:0} header.hero,section.panel{box-shadow:none} }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="hero">
      <div>
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
          <img src="https://killb.com/images/Logo.svg" alt="KillB logo" style="height:48px">
          <h1 style="margin:0;">Rewards</h1>
        </div>
        <a href="https://killb.com" target="_blank" class="site-link">Visita nuestro sitio</a>
        <p class="subtitle">Opera más cada día y paga menos comisiones.</p>
        <div class="badges">
          <span class="chip">Tasa base: <b>0,85%</b> (85 bps)</span>
          <span class="chip">Reducción diaria: <b>0,5 bps</b> (0,005%)</span>
          <span class="chip">Tope de descuento: <b>5 bps</b> (0,05%)</span>
          <span class="chip">Meta mínima: <b>500.000 USDT/día</b></span>
        </div>
        <p class="note">Cada día que alcanzas la meta, tu tasa para el día siguiente baja <b>0,5 bps</b>, hasta un tope de <b>5 bps</b> (tasa mínima 0,80%). Si no alcanzas la meta, la tasa del día siguiente <b>aumenta 1,0 bps</b>.</p>
      </div>
      <div class="viz">
        <div class="meter" title="Progreso hacia el tope de 5 bps"><i style="--p:0"></i></div>
        <div class="legend">
          <span>Descuento actual vs. base: <b id="accBps">0,0</b> bps</span>
          <span>Tasa aplicada hoy: <b id="appliedRate">0,850%</b></span>
          <span>Ahorro vs. 0,85%: <b id="savings">USDT 0</b></span>
        </div>
      </div>
    </header>

    <section class="panel">
      <h2 style="margin:0 0 6px;font-size:18px">Parámetros (edita para simular)</h2>
      <div class="grid">
        <div class="field">
          <label for="volume">Volumen diario (USDT)</label>
          <input id="volume" type="number" step="1000" value="500000">
        </div>
        <div class="field">
          <label for="base">Tasa base (%)</label>
          <input id="base" type="number" step="0.01" value="0.85">
        </div>
        <div class="field">
          <label for="step">Reducción (bps)</label>
          <input id="step" type="number" step="0.1" value="0.5">
        </div>
        <div class="field">
          <label for="penalty">Penalización (bps)</label>
          <input id="penalty" type="number" step="0.1" value="1.0">
        </div>
        <div class="field">
          <label for="cap">Tope de descuento (bps)</label>
          <input id="cap" type="number" step="0.1" value="5">
        </div>
        <div class="field">
          <label for="days">Días a simular</label>
          <input id="days" type="number" min="1" max="60" value="10">
        </div>
      </div>

      <div class="toolbar">
        <button class="btn" id="allHit">Marcar “meta alcanzada” en todos</button>
        <button class="btn ghost" id="noneHit">Desmarcar todos</button>
        <button class="btn ghost" id="altHit">Alternar (sí/no)</button>
      </div>

      <div class="kpis">
        <div class="kpi">
          <div class="lbl">Ahorro total en el período</div>
          <div class="val" id="totalSavings">USDT 0</div>
        </div>
        <div class="kpi">
          <div class="lbl">Mínima tasa alcanzada</div>
          <div class="val" id="minRate">0,850%</div>
        </div>
        <div class="kpi">
          <div class="lbl">Día en que alcanza el tope (5 bps)</div>
          <div class="val" id="capDay">—</div>
        </div>
      </div>

      <table id="tbl">
        <thead>
          <tr>
            <th>Meta</th>
            <th>Día</th>
            <th>Vol (USDT)</th>
            <th>Desc (bps)</th>
            <th>Tasa (%)</th>
            <th>Ahorro Mínimo (USDT)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <p class="note">
        Lógica: la tasa se calcula día a día. Si marcas la meta en un día, la <b>tasa del día siguiente</b> disminuye
        en <b>0,5 bps</b> (respetando el tope de 5 bps contra la base). Si no marcas la meta, la <b>tasa del día siguiente</b> aumenta
        en <b>1,0 bps</b>. <br>
        Ahorro diario = Volumen × (Tasa base − Tasa aplicada). El <i>Descuento acumulado</i> mostrado es la diferencia no negativa entre la tasa base y la tasa aplicada de ese día (capada a 5 bps).
      </p>
    </section>

    <footer>© KR — KillB OTC • Página personalizada en español</footer>
  </div>

  <script>
    const el = (id)=>document.getElementById(id);
    const volume = el('volume');
    const base = el('base');
    const step = el('step');
    const penalty = el('penalty');
    const cap = el('cap');
    const days = el('days');
    const tbody = document.querySelector('#tbl tbody');
    const accBps = el('accBps');
    const appliedRate = el('appliedRate');
    const savings = el('savings');
    const totalSavings = el('totalSavings');
    const minRate = el('minRate');
    const capDay = el('capDay');
    const meter = document.querySelector('.meter > i');

    [volume, base, step, penalty, cap, days].forEach(i=>i.addEventListener('input', render));

    function bpsToPct(bps){ return bps/100; } // 1 bps = 0,01%
    function pctFmt(x){ return (x*100).toFixed(3).replace('.',',') + '%'; }
    function moneyFmt(x){ return 'USDT ' + x.toLocaleString('en-US', {maximumFractionDigits:2}); }

    function buildRows(n){
      tbody.innerHTML='';
      for(let d=1; d<=n; d++){
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td style="text-align:center">
            <input type="checkbox" class="hit" ${d===1?'checked':''} aria-label="Alcanzó la meta">
          </td>
          <td>${d}</td>
          <td class="vol"></td>
          <td class="acc"></td>
          <td class="rate"></td>
          <td class="save"></td>`;
        tbody.appendChild(tr);
      }
      tbody.querySelectorAll('input.hit').forEach(cb => cb.addEventListener('change', render));
    }

    function render(){
      const vol = Math.max(0, +volume.value||0);
      const baseBps = (+base.value||0) * 100;      // p.ej., 0.85% -> 85 bps
      const stepBps = Math.max(0, +step.value||0); // 0.5 bps
      const penBps  = Math.max(0, +penalty.value||0); // 1.0 bps
      const capBps  = Math.max(0, +cap.value||0);  // 5 bps
      const n = Math.min(60, Math.max(1, +days.value||1));

      if (tbody.children.length !== n) buildRows(n);

      // Estado iterativo: comenzamos en tasa base (en bps)
      let rateBps = baseBps;
      let tot = 0, minApplied = rateBps/10000, capHitDay = null;

      const hits = Array.from(tbody.querySelectorAll('input.hit')).map(x=>x.checked);
      // recalcular en caso de cambio del número de días
      if (hits.length !== n){
        buildRows(n);
      }

      const rows = Array.from(tbody.querySelectorAll('tr'));
      rows.forEach((tr, idx) => {
        const day = idx+1;
        const hit = tr.querySelector('input.hit').checked;

        // Garantir que a taxa nunca ultrapasse a taxa base
        if (rateBps > baseBps) {
          rateBps = baseBps;
        }

        // Tasa aplicada del día actual (rateBps ya contiene el estado acumulado)
        const appliedPct = rateBps / 10000; // bps -> fracción
        const discountBpsToday = Math.min(Math.max(baseBps - rateBps, 0), capBps);
        const econ = vol * ((baseBps - rateBps) / 10000); // puede ser 0 si por encima de base

        // Fill row
        tr.querySelector('.vol').textContent  = vol.toLocaleString('en-US');
        tr.querySelector('.acc').textContent  = discountBpsToday.toFixed(1).replace(',',',');
        tr.querySelector('.rate').textContent = pctFmt(appliedPct);
        tr.querySelector('.save').textContent = econ.toFixed(2);

        // KPIs
        tot += Math.max(econ, 0); // ahorro no negativo
        minApplied = Math.min(minApplied, appliedPct);
        if (discountBpsToday >= capBps && capHitDay === null) capHitDay = day;

        // Calcular tasa del día siguiente según checkbox
        if (hit){
          // Reducción, respetando piso de base - tope
          rateBps = Math.max(baseBps - capBps, rateBps - stepBps);
        } else {
          // Penalización: sube el doble del paso (1.0 bps por defecto)
          rateBps = rateBps + penBps;
        }
      });

      // Top widgets: usamos el último día como referencia
      const lastAppliedPct = (rateBps /* ya es next */ + (rows.length?0:0)) / 10000; // no usado directamente
      // Para mostrar el estado del último día realmente aplicado:
      const lastRow = rows[rows.length-1];
      const lastDisc = lastRow ? parseFloat(lastRow.querySelector('.acc').textContent.replace(',','.')) || 0 : 0;
      const lastRate = lastRow ? lastRow.querySelector('.rate').textContent : pctFmt(baseBps/10000);
      const lastSavings = lastRow ? parseFloat(lastRow.querySelector('.save').textContent) || 0 : 0;

      accBps.textContent = lastDisc.toFixed(1).replace('.',',');
      appliedRate.textContent = lastRate;
      savings.textContent = moneyFmt(Math.max(lastSavings,0));

      totalSavings.textContent = moneyFmt(tot);
      minRate.textContent = pctFmt(minApplied);
      capDay.textContent = capHitDay ? capHitDay : '—';
      meter.style.setProperty('--p', (capBps ? (lastDisc/capBps) : 0).toFixed(3));
    }

    // Inicializar
    render();

    // Botones rápidos
    document.getElementById('allHit').addEventListener('click', ()=>{
      document.querySelectorAll('input.hit').forEach(cb=>cb.checked=true);
      render();
    });
    document.getElementById('noneHit').addEventListener('click', ()=>{
      document.querySelectorAll('input.hit').forEach(cb=>cb.checked=false);
      render();
    });
    document.getElementById('altHit').addEventListener('click', ()=>{
      document.querySelectorAll('input.hit').forEach((cb,i)=> cb.checked = (i%2===0) );
      render();
    });
  </script>
</body>
</html>
